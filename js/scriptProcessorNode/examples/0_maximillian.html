<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<title>
		Javascript Audio Processing
	</title>
	<!-- <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=js&amp;skin=sunburst" defer="defer"></script> -->
	<!-- show all line numbers-->
	<style type="text/css">
		.prettyprint ol.linenums>li {
			list-style-type: decimal
		}
	</style>

	<script src="../build/maximilian.js"></script>



</head>

<body>
	<h1> Maximilian.js Test Zone </h1>
	<p id="funcs"></p>
	<p>
		!!!
	</p>
	<button id="playButton">Play</button>
	<!-- <pre class="prettyprint lang-js linenums:true" id="quine" style="border:4px solid #88c" > -->
	</pre>
</body>
<!-- Our javascript code -->
<script type="text/javascript">
	let maxi = maximilian();

	// em++ -s WASM=0
<<<<<<< HEAD
	var maxiEngine = new maxi.maxiAudio();
	var osc1= new maxi.maxiOsc();
	var osc2= new maxi.maxiOsc();
=======
	var osc1 = new maxi.maxiOsc();
	var filt1 = new maxi.maxiFilter();
	var ma = new maxi.maxiAudio();

	// ma.init();

	var sound = new maxi.maxiOsc();
	var bass = new maxi.maxiOsc();
	var timer = new maxi.maxiOsc();
	var mod = new maxi.maxiOsc();
	var lead = new maxi.maxiOsc();
	var lead2 = new maxi.maxiOsc();
	var leadmod = new maxi.maxiOsc();

	var envelope = new maxi.maxiEnv();
	var leadenvelope = new maxi.maxiEnv();

	var filter = new maxi.maxiFilter();
	var filter2 = new maxi.maxiFilter();

	var delay = new maxi.maxiDelayline();

	var mtof = new maxi.convert();

	var bassout, leadout, delayout; //some variables to hold the data and pass it around
	var trigger, trigger2, newnote = 0; //some control variables
	var currentCount, lastCount, playHead = 0,
		currentChord = 0; //some other control variables
	var pitch = [57, 57, 59, 60]; //the bassline for the arpeggio
	var chord = [0, 0, 7, 2, 5, 5, 0, 0]; //the root chords for the arpeggio
	var currentPitch, leadPitch; //the final pitch variables

	//here's the lead line trigger array, followed by the pitches
	var leadLineTrigger = [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
		1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,
		0, 1, 0, 0, 0, 0,
		0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0,
		0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
	];
	var leadLinePitch = [69, 67, 65, 64, 67, 66, 64, 62, 65, 64, 62, 57, 55, 60, 57];


	var samplePlayer = new maxi.maxiSample();

	// load sample to 'samplePlayer' using 'audio' object
	// ma.loadSample("audio/beat2.wav", samplePlayer);
>>>>>>> d45b310d6ac9dfe09e0a641dbc575d8343bfe3b4

	maxiEngine.listInputDevices();
	let playAudio = () => {

<<<<<<< HEAD
		maxiEngine.init(0);
=======
		// em++ -s WASM=1
		// var mySine = new m.maxiOsc();
		// var ma = new m.maxiAudio();
		ma.init();
		ma.outputIsArray(true, 2);

		ma.play = function () {
			// this.output = filt1.lores(osc1.sawn(200), 1000, 0.5);
			// this.output = samplePlayer.play();
			currentCount = Math.floor(timer.phasor(9)); //this sets up a metronome that ticks every so often

			if (lastCount != currentCount) { //if we have a new timer int this sample, play the sound
				trigger = 1; //play the arpeggiator line
				trigger2 = leadLineTrigger[playHead % 256]; //play the lead line
				if (trigger2 == 1) { //if we are going to play a note
					leadPitch = mtof.mtof(leadLinePitch[newnote]); //get the next pitch val
					newnote++; //and iterate
					if (newnote > 14) {
						newnote = 0; //make sure we don't go over the edge of the array
					}
				}
				currentPitch = mtof.mtof(pitch[(playHead % 4)] + chord[currentChord %
				8]); //write the frequency val into currentPitch
				playHead++; //iterate the playhead
				if (playHead % 32 == 0) { //wrap every 4 bars
					currentChord++; //change the chord
				}
				//cout << "tick\n";//the clock ticks
				lastCount = 0; //set lastCount to 0
			}

			bassout = filter2.lores(envelope.adsr(bass.saw(currentPitch * 0.5) + sound.pulse(currentPitch * 0.5, mod
				.phasor(1)), 1, 0.9995, 0.25, 0.9995, 1, trigger), 9250, 2); //new, simple ADSR.
			leadout = filter.lores(leadenvelope.ar(lead2.saw(leadPitch * 4) + lead.pulse(leadPitch + (leadmod.sinebuf(
				1.9) * 1.5), 0.6), 0.00005, 0.999975, 50000, trigger2), 5900, 10); //leadline

			delayout = (leadout + (delay.dl(leadout, 14000, 0.8) * 0.5)) / 2; //add some delay

			if (trigger != 0) trigger = 0; //set the trigger to off if you want it to trigger immediately next time.
>>>>>>> d45b310d6ac9dfe09e0a641dbc575d8343bfe3b4

		maxiEngine.play = function(input) {
			return osc1.sinewave(1000) * osc2.sinewave(300) * input[0];
		}
	}



	const playButton = document.getElementById('playButton');
	playButton.addEventListener("click", () => playAudio());
</script>

</html>